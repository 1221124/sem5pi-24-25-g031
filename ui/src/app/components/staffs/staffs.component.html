<div class="staffs-request">
    <h1>Staffs</h1>
    <button (click)="goToAdmin()" class="btn btn-outline-primary back-btn">Back to Admin Home</button>
    <button type="button" class="create-staff-btn" (click)="openModal()">Create Staff</button>

    <div *ngIf="isCreateModalOpen" class="modal">
        <div class="modal-content">
            <span type="button" class="close" (click)="closeModal()">&times;</span>
            <h2>Create New Staff</h2>

            <section>
                <form>
                    <div class="form-group">
                        <input type="text" id="firstName" name="firstName" [(ngModel)]="firstName"
                            (focus)="firstNameTouched = true" placeholder="Enter First Name" />
                    </div>

                    <div class="form-group">
                        <input type="text" id="lastName" name="lastName" [(ngModel)]="lastName"
                            (focus)="lastNameTouched = true" placeholder="Enter Last Name" />
                    </div>

                    <div class="form-group">
                        <input type="text" id="email" name="email" [(ngModel)]="email" (focus)="emailTouched = true"
                            placeholder="Enter Email" />
                    </div>

                    <div class="form-group">
                        <input type="text" id="phoneNumber" name="phoneNumber" [(ngModel)]="phoneNumber"
                            (focus)="phoneNumberTouched = true" placeholder="Enter Phone Number" />
                    </div>

                    <div class="form-group">
                        <label for="specialization">Select Specialization:</label>
                        <select id="specialization" name="specialization" [(ngModel)]="specialization"
                            (focus)="specializationTouched = true">
                            <option value="Anaesthesiology">Anaesthesiology</option>
                            <option value="Cardiology">Cardiology</option>
                            <option value="Circulating">Circulating</option>
                            <option value="Instrumental">Instrumental</option>
                            <option value="Medical_Action">Medical Action</option>
                            <option value="Orthopaedics">Orthopaedics</option>
                            <option value="X_Ray">X Ray</option>
                        </select>
                    </div>

                    <div class="radio-staff">
                        <label><input type="radio" name="role" [(ngModel)]="role" value="D"> Doctor</label>
                        <label><input type="radio" name="role" [(ngModel)]="role" value="N"> Nurse</label>
                        <label><input type="radio" name="role" [(ngModel)]="role" value="T"> Technician</label>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="submit-button" (click)="submitRequest()">Submit</button>
                        <button type="button" class="clear-button" (click)="clearForm()">Clear</button>
                    </div>
                </form>
            </section>
        </div>
    </div>

    <div *ngIf="staffs.length > 0; else noStaffs">
        <table>
            <thead>
                <tr>
                    <th colspan="2">
                        Name
                        <select [(ngModel)]="filter.name" name="name" id="name">
                            <option *ngFor="let name of names" [value]="name">
                                {{ name }}
                            </option>
                        </select>
                    <th>
                        Email
                        <select [(ngModel)]=" filter.email" name="email" id="email">
                            <option *ngFor="let email of emails" [value]="email">
                                {{ email }}
                            </option>
                        </select>
                    </th>
                    <th colspan="2">
                        Specialization
                        <select [(ngModel)]="filter.specialization" name="specialization" id="specialization">
                            <option *ngFor="let spec of specializations" [value]="spec">
                                {{ spec }}
                            </option>
                        </select>
                    </th>
                </tr>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>License Number</th>
                    <th>Specialization</th>
                    <th>Status</th>
                    <th>Slots Appointment</th>
                    <th>Slots Availability</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let staff of staffs">
                    <td>{{ staff.FullName.FirstName }}</td>
                    <td>{{ staff.FullName.LastName }}</td>
                    <td>{{ staff.ContactInformation.Email }}</td>
                    <td>{{ staff.ContactInformation.PhoneNumber }}</td>
                    <td>{{ staff.licenseNumber || 'N/A' }}</td>
                    <td>{{ staff.specialization || 'N/A' }}</td>
                    <td>{{ staff.status || 'N/A' }}</td>
                    <td>
                        <button type="button" (click)="openSlotAppointmentModal(staff)">View</button>
                    </td>
                    <td>
                        <button type="button" (click)="openSlotAvailabilityModal(staff)">View</button>
                    </td>
                    <td>
                        <button *ngIf="staff.status === 'Active'" (click)="editStaff(staff)"
                            class="action-btn edit-btn">
                            Edit
                        </button>
                        <button *ngIf="staff.status === 'Active'" type="button" class="action-btn delete-btn"
                            (click)="confirmDelete(staff)">Inactive
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="filter-buttons">
            <button (click)="applyFilter()">Apply Filters</button>
            <button (click)="clearFilters()">Clear Filters</button>
        </div>
    </div>

    <ng-template #noStaffs>
        <div *ngIf="message; else loading">
            <p>{{ message }}</p>
        </div>
    </ng-template>

    <ng-template #loading>
        <p>Loading...</p>
    </ng-template>




    <div class="pagination">
        <button (click)="changePage(currentPage - 1)" [disabled]="currentPage <= 1">Previous</button>
        <span>Page {{ currentPage }} of {{ totalPages }}</span>
        <button (click)="changePage(currentPage + 1)" [disabled]="currentPage >= totalPages">Next</button>
    </div>

    <div *ngIf="isDeleteModalOpen" class="modal">
        <div class="modal-content">
            <span class="close" (click)="closeDeleteModal()">&times;</span>
            <h2>Confirm Delete</h2>
            <p>Are you sure you want to delete this staff member?</p>
            <div class="button-group">
                <button type="button" class="confirm-button" (click)="deleteConfirmed()">Confirm</button>
                <button type="button" class="cancel-button" (click)="closeDeleteModal()">Cancel</button>

            </div>
        </div>
    </div>

    <div *ngIf="isEditModalOpen" class="modal">
        <div class="modal-content">
            <span type="button" class="close" (click)="closeModal()">&times;</span>
            <h2>Edit Staff</h2>

            <form (ngSubmit)="saveStaff()">
                <div>
                    <label for="firstName">First Name</label>
                    <input type="text" id="firstNameEdit" [(ngModel)]="selectedStaff.firstName.value"
                        name="firstName" />
                </div>
                <div>
                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastNameEdit" [(ngModel)]="selectedStaff.lastName.value" name="lastName" />
                </div>
                <div>
                    <label for="email">Email</label>
                    <input type="text" id="emailEdit" [(ngModel)]="selectedStaff.email.value" name="email" />
                </div>
                <div>
                    <label for="phoneNumber">Phone Number</label>
                    <input type="text" id="phoneNumberEdit" [(ngModel)]="selectedStaff.phoneNumber.value"
                        name="phoneNumber" />
                </div>
                <h3>Slots History</h3>
                <button type="button" (click)="openAddSlotAvailabilityForm()">Add Slot</button>

                <!-- Add Slot Form - Initially hidden, shows when Add Slot button is clicked -->
                <div *ngIf="isAddSlotAvailabilityFormVisible">
                    <div>
                        <label for="start">Start Date</label>
                        <input type="datetime-local" id="start" [(ngModel)]="newSlotStart" name="start" required />
                    </div>
                    <div>
                        <label for="end">End Date</label>
                        <input type="datetime-local" id="end" [(ngModel)]="newSlotEnd" name="end" required />
                    </div>
                    <button type="button" (click)="addNewSlotAvailability()">Add Slot</button>
                </div>

                <div class="button-group">
                    <button type="button" (click)="saveStaff()">Save Staff</button>
                </div>
            </form>
        </div>
    </div>

    <div *ngIf="isSlotAppointmentModal" class="modal">
        <div class="modal-content">
            <span type="button" class="close" (click)="closeSlotAppointmentModal()">&times;</span>
            <h2>Slots Appointments</h2>
            <table>
                <thead>
                    <tr>
                        <th>Slot History</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div *ngIf="selectedStaff.slotAppointment?.length > 0; else noSlotsMessage">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Start</th>
                                            <th>End</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let slot of selectedStaff.slotAppointment">
                                            <td>{{ slot.start | date: 'yyyy-MM-dd HH:mm' }}</td>
                                            <td>{{ slot.end | date: 'yyyy-MM-dd HH:mm' }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <ng-template #noSlotsMessage>
                                <p>No slots available</p>
                            </ng-template>
                        </td>
                    </tr>
            </table>
        </div>
    </div>


    <div *ngIf="isSlotAvailabilityModal" class="modal">
        <div class="modal-content">
            <span type="button" class="close" (click)="closeSlotAvailabilityModal()">&times;</span>
            <h2>Slots Availability</h2>
            <table>
                <thead>
                    <tr>
                        <th>Slot History</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div *ngIf="selectedStaff.slotAvailability?.length > 0; else noSlotsMessage">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Start</th>
                                            <th>End</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let slot of selectedStaff.slotAvailability">
                                            <td>{{ slot.start | date: 'yyyy-MM-dd HH:mm' }}</td>
                                            <td>{{ slot.end | date: 'yyyy-MM-dd HH:mm' }}</td>
                                            <td><button type="button" class="action-btn delete-btn"
                                                    (click)="deleteSlotAvailability()">Delete</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <ng-template #noSlotsMessage>
                                <p>No slots available</p>
                            </ng-template>
                        </td>
                    </tr>
            </table>
        </div>
    </div>
</div>